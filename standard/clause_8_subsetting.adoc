[[rc_subsetting_spatial]]
== Requirements Class "Spatial Subsetting"

=== Overview

The "Spatial Subsetting" Requirements Class specifies the `subset` parameter for the coverage resource, allowing to retrieve only a subset of the coverage along one or more spatial dimensions.
With the `subset` parameter, a subset operation may be a trimming operation (preserving dimensionality) or slicing operation (reducing dimensions), depending on whether a single coordinate or an interval is used.
A client wishing to preserve dimensionality while requesting a single coordinate value may duplicate this value into an interval, for example: `subset=lon(20:20)`.

Negotiating a response in a format with limited multidimensionality support, such as image-based format like GeoTIFF, also implies a reduced dimensionality.

When subsetting a coverage within a lower and upper bound, a trimming operation is performed, and the response will preserve the dimension being subset.
When subsetting a coverage for a single value, a slicing operation is performed, and the response will not contain that dimension being subset.

When subsetting a coverage, the geometry of its individual components (such as the cells of a gridded coverage) must be considered.

If the value for the cells of a gridded coverage represent an area, the geometry of the cells extends over that whole area.
If the value for the cells of a gridded coverage coverage represent a point, the geometry of the cells is only that infinitely small point.

The values to include in the response will be all **individual components (such as gridded coverage cells) whose geometry's interior** intersects the **interior or the boundary of the subsetting extent**, in line with the https://en.wikipedia.org/wiki/DE-9IM[DE9-IM] model.

For gridded coverage cells whose geometry is a point, this will **include** all cells falling exactly on the boundary of the subset (**the interior of a point is the point itself**).

For gridded coverage cells whose geometry is an area, this will **exclude** the cells boundaries falling exactly on the boundary of the subset (**the interior of an area excludes its boundary**).

[#subset-aligned,reftext='{figure-caption} {counter:fig-num}']
.Responses for a subsetting request aligned to the coverage grid for _Value-is-Point_ (span = 0) vs. _Value-is-Area_ (span = 1)
image::figures/spanSubset.png[]

[#subset-non-aligned,reftext='{figure-caption} {counter:fig-num}']
.Responses for a subsetting request not aligned to the coverage grid for _Value-is-Point_ (span = 0) vs. _Value-is-Area_ (span = 1)
image::figures/spanSubsetNonAligned.png[]

In addition to the `subset` parameter, server implementations must also support a convenience `bbox` parameter, which maps directly to an equivalent `subset` parameter performing a trimming operation.
While the `subset` parameter allows to more explicitly reference a particular spatial axis and avoiding related confusion, the `bbox` parameter may feel simpler and more familiar to some users.
Both the `subset` and the `bbox` parameters are aligned with the spatial subsetting capabilities of OGC API - Maps.

include::requirements/requirements_class_coverage_subset_spatial.adoc[]

[[rc_subsetting_temporal]]
== Requirements Class "Temporal Subsetting"

=== Overview

The "Temporal Subsetting" Requirements Class specifies the `subset` parameter for the coverage resource, allowing to retrieve only a subset of the coverage along the primary temporal dimension.
With the `subset` parameter, a subset operation may be a trimming operation (preserving dimensionality) or slicing operation (reducing dimensions), depending on whether a single coordinate or an interval is used.
Negotiating a response in a format with limited multidimensionality support, such as image-based format like GeoTIFF, also implies a reduced dimensionality.

When subsetting a coverage within a lower and upper bound, a trimming operation is performed, and the response will preserve the dimension being subset.
When subsetting a coverage for a single value, a slicing operation is performed, and the response will not contain that dimension being subset.

When subsetting a coverage, the geometry of its individual components (such as the cells of a gridded coverage) must be considered.

If the value for the cells of a gridded coverage represent an area, the geometry of the cells extends over that whole area.
If the value for the cells of a gridded coverage represent a point, the geometry of the cells is only that infinitely small point.

The values to include in the response will be all **individual components whose geometry's interior** intersects the **interior or the boundary of the subsetting extent**, in line with the https://en.wikipedia.org/wiki/DE-9IM[DE9-IM] model.

For gridded coverage cells whose geometry is a point, this will **include** all cells falling exactly on the boundary of the subset (**the interior of a point is the point itself**).

For gridded coverage cells whose geometry is an area, this will **exclude** the cells boundaries falling exactly on the boundary of the subset (**the interior of an area excludes its boundary**).

In addition to the `subset` parameter, server implementations must also support a convenience `datetime` parameter, which maps directly to an equivalent `subset` parameter performing either a slicing or trimming operation.
While the `subset` parameter allows to more explicitly reference the primary temporal dimension, the `datetime` parameter may feel simpler and more familiar to some users.
Both the `subset` and the `bbox` parameters are aligned with the temporal subsetting capabilities of OGC API - Maps.

include::requirements/requirements_class_coverage_subset_temporal.adoc[]

[[rc_subsetting_general]]
== Requirements Class "General Subsetting"

=== Overview

The "General Subsetting" Requirements Class specifies the `subset` parameter for the coverage resource, allowing to retrieve only a subset of the coverage along one or more dimensions beyond spatial and the primary temporal dimension.
With the `subset` parameter, a subset operation may be a trimming operation (preserving dimensionality) or slicing operation (reducing dimensions), depending on whether a single coordinate or an interval is used.
Negotiating a response in a format with limited multidimensionality support, such as image-based format like GeoTIFF, also implies a reduced dimensionality.

When subsetting a coverage within a lower and upper bound, a trimming operation is performed, and the response will preserve the dimension being subset.
When subsetting a coverage for a single value, a slicing operation is performed, and the response will not contain that dimension being subset.

When subsetting a coverage, the geometry of its individual components (such as the cells of a gridded coverage) must be considered.

If the value for the cells of a gridded coverage represent an area, the geometry of the cells extends over that whole area.
If the value for the cells of a gridded coverage represent a point, the geometry of the cells is only that infinitely small point.

The values to include in the response will be all **individual components whose geometry's interior** intersects the **interior or the boundary of the subsetting extent**, in line with the https://en.wikipedia.org/wiki/DE-9IM[DE9-IM] model.

For gridded coverage cells whose geometry is a point, this will **include** all cells falling exactly on the boundary of the subset (**the interior of a point is the point itself**).

For gridded coverage cells whose geometry is an area, this will **exclude** the cells boundaries falling exactly on the boundary of the subset (**the interior of an area excludes its boundary**).

include::requirements/requirements_class_coverage_subset_general.adoc[]

[[rc_multi_slicing]]
== Requirements Class "Multi Slicing"

=== Overview

The "Multi Slicing" Requirements Class specifies the ability to use a comma-separated list of arbitrary values with the `subset` parameter for the coverage resource,
allowing to retrieve specific slices from the coverage along a particular dimension. This requirements class is automatically applicable for subsetting with the dimensions supported by any of the
spatial, temporal and general subsetting requirements classes.

While slicing generally reduces the dimensionality of the results, since this operation always returns multiple slices, the dimensionality is preserved.

For example, this requirements class, in combination with General Subsetting, is useful to request specific pressure levels: `subset=pressure(200,300,500,700,850)`.

Another common practical use case for this conformance class is to request specific temporal slices which may be at irregular intervals, for example: `subset=time("2025-10-01", "2025-10-04", "2025-10-05")`.

This capability is also useful for requesting a subset of the data for multiple categories along a categorical dimension, for example `subset=species("wildcats", "frogs")`.

include::requirements/requirements_class_coverage_multi_slicing.adoc[]

[[rc_position_query]]
== Requirements Class "Position Query"

=== Overview

The "Position Query" Requirements Class specifies the ability to query the value(s) for a specific point position by slicing on every dimension of the coverage therefore
reducing the dimensionality of the response to zero. In the common use case, the response consists of a single numerical value.
Raster or gridded coverage formats are typically not well suited to express such responses.
In these cases, information about the domain or range, other metadata, as well as the more complex format structures are also not necessary and can negatively affect the
bandiwdth usage and performance for a very large numbers of these queries.
This requirements class introduces a simple JSON representation which needs to be supported by the server.
Implementations could also implement additional representations, for example GeoJSON.

include::requirements/requirements_class_coverage_position_query.adoc[]

=== Examples

The following examples illustrate the JSON response to position queries where all dimensions of the coverage have been sliced on,
reducing the dimensionality of the response to zero.

==== Single field, single element

`GET /collections/dem/coverage?subset=Lat(45.4844),Lon(-75.72205)`

[source,json]
----
68.869
----

==== Multiple fields, single element

`GET /collections/weather/coverage?subset=Lat(45.4844),Lon(-75.72205),time("2025-07-05")`


[source,json]
----
{ "temperature": 28.1, "relativeHumidity": 0.35 }

----

==== Single fields, multiple elements

`GET /collections/animals/coverage?subset=Lat(45.4844),Lon(-75.72205)`

[source,json]
----
[ "foxes", "wolves" ]
----

==== Multiple fields, multiple elements

`GET /collections/weather-stations/coverage?subset=Lat(45.4844),Lon(-75.72205),time("2025-07-05")`

[source,json]
----
[
   {
      "temperature": 28.1,
      "relativeHumidity": 0.35,
      "deviceID": "AB123"
   },
   {
      "temperature": 28.2,
      "relativeHumidity": 0.34,
      "deviceID": "CD456"
   }
]
----
